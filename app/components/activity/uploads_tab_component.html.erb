<turbo-frame id="uploads_tab">
<div class="tab-pane fade show active" id="uploads-pane" role="tabpanel" aria-labelledby="uploads-tab">
  <table class="table table-striped mb-3" id="uploads-table">
    <thead>
      <tr>
        <th><span class="visually-hidden">Icon</span></th>
        <th><%= t('activity.table.provider') %></th>
        <th><%= t('activity.table.history') %></th>
        <th><%= t('activity.table.last_upload') %></th>
      </tr>
    </thead>
    <tbody>
      <% recent_uploads_by_provider.each do |provider, uploads| %>
        <tr data-turbo="false">
          <td class="align-middle text-center icon-column">
            <% if provider.icon.attached? %>
              <%= link_to image_tag(provider.icon, alt: '', class: 'icon-sm'), provider, aria: { hidden: true } %>
            <% end %>
          </td>
          <th class="fw-normal align-middle"><%= link_to provider.name, organization_path(provider) %></th>
          <!-- Did any uploads succeed in past 30 days? -->
          <td>
            <% if uploads.any? %>
              <%= render Activity::UploadStatusSparklineComponent.new(organization: provider, uploads: uploads) %>
            <% else %>
              <p class="mb-0"><i class="bi bi-exclamation-triangle-fill text-warning me-1"></i> No uploads in last 30 days</p>
            <% end %>
          </td>
          <!-- Most recent upload: -->
          <td>
            <% if upload = uploads.first || provider.latest_upload %>
              <%= render StatusIcons::UploadStatusIconComponent.new(status: upload.metadata_status) %>
              <%= link_to helpers.local_time(upload.created_at, format: helpers.datetime_display_format()), organization_upload_path(provider, upload) %>
            <% else %>
              <i class="bi bi-exclamation-triangle-fill text-warning pod-icon"></i>
            <% end %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>
</turbo-frame>
