<%= render 'shared/layout_upload_page' do %>

  <div class="d-flex align-items-center">

    <h2 class="font-weight-normal mb-0">Uploads</h2>

    <div class="ms-auto p-2">
      <span class="ms-4"><%= link_to 'New upload to default stream', new_organization_upload_path(@organization), class: 'btn btn-primary' if can? :create, @organization.default_stream.uploads.build %></span>
    </div>

  </div>

  <%= turbo_frame_tag @stream, 'uploads' do %>
    <%= form_with url: organization_uploads_path(@organization), class: 'bg-light my-2 p-2 border rounded d-flex gap-4 align-items-center', method: 'GET', data: { controller: 'filter' } do |f| %>
    <span class="fs-5 fw-semibold">Filter uploads</span>

    <%= f.hidden_field :stream, value: @stream.to_param %>

    <div class="d-flex flex-nowrap align-items-center gap-2">
      <%= f.label :metadata_status, 'By file status', class: 'text-nowrap' %>
      <% metadata_status_options = Settings.upload_status.keys.index_by { |key| Settings.upload_status[key].label }.to_a %>
      <%= f.select :metadata_status, options_for_select([['All files', nil], *metadata_status_options], selected: params[:metadata_status]), {}, class: 'form-select', data: { action: 'filter#submit' } %>
    </div>

    <div class="d-flex flex-nowrap align-items-center gap-2">
      <%= f.label :metadata_status, 'By date', class: 'text-nowrap' %>
      <div class="input-group">
        <%= f.date_field :created_at, value: params[:created_at], class: 'form-control', data: { action: 'filter#submit' } %>
        <button class="btn btn-secondary btn-sm" name="created_at" value="">Reset</button>
      </div>
    </div>

    <%= f.submit 'Filter', class: 'btn btn-primary visually-hidden' %>
  <% end %>

    <% if @uploads.none? %>
      <em>No uploads found.</em>
    <% else %>
      <ul class="table-key list-unstyled list-inline pt-3" id="upload-filters">
        <% Settings.upload_status.keys.each do |status| %>
          <li class="list-inline-item">
            <%= render(StatusIcons::UploadStatusIconComponent.new(status: status, show_label: true)) %>
          </li>
        <% end %>
      </ul>

      <%= render 'uploads/table' do %>
          <% @uploads.each do |upload| %>
            <%= render 'uploads/row', upload: upload %>
          <% end %>
      <% end %>

      <%= paginate @uploads %>
    <% end %>
  <% end %>
<% end %>
