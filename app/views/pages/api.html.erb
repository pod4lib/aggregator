<div class="container mt-3">
  <h2 class="display-4">API Documentation</h2>

  <h3>Uploading a new "full dump"</h3>
  <h4 class="mt-3">API documentation</h4>
  <ul class="list-group">
    <li class="list-group-item">
      <span class="badge badge-info mr-3">POST</span><%= content_tag :span, organization_uploads_url(organization_id: '$ORG_CODE'), class: 'text-monospace font-weight-bolder' %> Upload a file or files to the default stream
      <table class="table">
        <thead><th>Name</th><th>Description</th></thead>
        <tbody>
          <tr><td class="text-monospace">upload[files][]</td><td>Attach one or more files; see the <%= link_to 'data documentation', pages_url(id: 'data') %> for more information about accepted file types. Each uploaded file SHOULD include a <code>Content-Type</code> (one of: <code>application/marc</code>, <code>application/marcxml+xml</code>, or <code>text/plain</code> (for plain text deletes)).</td></tr>
          <tr><td class="text-monospace">upload[url]</td><td>"Upload" from an external URL; POD will attempt to download the file from this URL</td></tr>
          <tr><td class="text-monospace">stream</td><td>(optional) a locally-defined value used to group multiple uploads together</td></tr>
        </tbody>
      </table>
    </li>
    <li class="list-group-item mt-3 border-top">
      <span class="badge badge-info mr-3">POST</span><%= content_tag :span, make_default_organization_streams_url(organization_id: '$ORG_CODE', stream: 'STREAM_ID').sub('STREAM_ID', '$STREAM_ID'), class: 'text-monospace font-weight-bolder' %> Mark a named stream as the default stream
      <table class="table">
        <thead><th>Name</th><th>Description</th></thead>
        <tbody>
          <tr><td class="text-monospace">stream</td><td>a locally-defined value (see above); by making the stream the "default", it will be exposed for harvesting</td></tr>
        </tbody>
      </table>
    </li>
  </ul>

  <h4 class="mt-5">Full example:</h4>
  <pre>
    # Set up some environment information (and, in reality, consider protecting your ACCESS_TOKEN by some means)
    $ export ORG_CODE="..." # put your organization code (e.g. 'stanford')
    $ export ACCESS_TOKEN="..." # put your access token here
    $ export STREAM_ID=$(date +%F) #  or some other identifier for the stream

    # Upload the e.g. MARC21 files in the current directory in a single upload
    $ ls -d * | xargs -I{} printf "\-F 'upload[files][]=@%s;type=application/marc' " {} {} | xargs curl -H "Authorization: Bearer $ACCESS_TOKEN" --url <%= organization_uploads_url(organization_id: '$ORG_CODE', stream: 'STREAM_ID').sub('STREAM_ID', '$STREAM_ID') %>
    # use application/marcxml+xml for MARCXML, and text/plain for newline-delimited deletes.

    # OR, upload multiple files in parallel
    $ ls -d * | xargs -I{} curl -F 'upload[files][]=@{};type=application/marc' -H 'Authorization: Bearer $ACCESS_TOKEN' --url <%= organization_uploads_url(organization_id: '$ORG_CODE', stream: 'STREAM_ID').sub('STREAM_ID', '$STREAM_ID') %>
    # Make the full dump available for harvesting
    $ curl -X POST -H "Authorization: Bearer $ACCESS_TOKEN" --url <%= make_default_organization_streams_url(organization_id: '$ORG_CODE', stream: 'STREAM_ID').sub('STREAM_ID', '$STREAM_ID') %>
  </pre>
</div>
